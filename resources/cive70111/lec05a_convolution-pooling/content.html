<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Convolution & Pooling</title>
    <script src="../phoebe-js/mathhelper.js"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="../phoebe-js/phoebe.css">
    <link rel="stylesheet" href="../phoebe-js/demo-common.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="iframe-content">
        <div class="container">

        <div class="infotab">
            <div class="infotab-header">
            </div>
            <div class="infotab-content">
                <div class="infotab-panel active" data-tab-title="Introduction">
                    <h3>Convolution & Pooling Operations</h3>
                    <p>This interactive demonstration explores two fundamental operations in convolutional neural networks (CNNs): <strong>convolution</strong> and <strong>pooling</strong>.</p>

                    <p><strong>Convolution</strong> applies filters (kernels) to detect features like edges, patterns, and textures in images. Different filters highlight different characteristics of the input data.</p>

                    <p><strong>Pooling</strong> reduces the spatial dimensions of feature maps while preserving the most important information, making the network more efficient and translation-invariant.</p>

                    <p>Use the interactive controls to experiment with different input patterns, filters, and pooling operations to understand how these operations transform data in deep learning systems.</p>
                </div>

                <div class="infotab-panel" data-tab-title="Theory">
                    <h3>Mathematical Foundation</h3>

                    <h4>Convolution Operation</h4>
                    <p>Convolution applies a filter $F$ to an input image $I$ to produce a feature map $O$:</p>
                    <p>$$O(i,j) = \sum_{m=0}^{M-1} \sum_{n=0}^{N-1} I(i+m, j+n) \cdot F(m,n)$$</p>

                    <p><strong>Key Concepts:</strong></p>
                    <ul>
                        <li><strong>Filters/Kernels:</strong> Small matrices (typically 3×3) that detect specific features</li>
                        <li><strong>Feature Maps:</strong> Output matrices showing where features were detected</li>
                        <li><strong>Translation Equivariance:</strong> Same features detected regardless of position</li>
                    </ul>

                    <h4>Pooling Operations</h4>
                    <p><strong>Max Pooling:</strong> $P(i,j) = \max_{(m,n) \in R_{i,j}} F(m,n)$</p>
                    <p><strong>Average Pooling:</strong> $P(i,j) = \frac{1}{|R_{i,j}|} \sum_{(m,n) \in R_{i,j}} F(m,n)$</p>

                    <p>Where $R_{i,j}$ represents the pooling window region.</p>

                    <p><strong>Benefits:</strong></p>
                    <ul>
                        <li><strong>Dimensionality Reduction:</strong> Reduces computational load</li>
                        <li><strong>Translation Invariance:</strong> Small shifts don't change output</li>
                        <li><strong>Feature Abstraction:</strong> Focuses on most relevant information</li>
                    </ul>
                </div>

                <div class="infotab-panel" data-tab-title="Instructions">
                    <h3>How to Use This Demo</h3>

                    <h4>Input Controls</h4>
                    <ul>
                        <li><strong>Input Image:</strong> Select different patterns to see how filters respond
                            <ul>
                                <li>Simple Pattern: Cross shape for basic testing</li>
                                <li>Vertical/Horizontal Edges: Test edge detection filters</li>
                                <li>Checkerboard: High-frequency pattern</li>
                                <li>Gradient: Smooth intensity transition</li>
                            </ul>
                        </li>
                    </ul>

                    <h4>Filter Controls</h4>
                    <ul>
                        <li><strong>Filter Type:</strong> Choose predefined filters or create custom ones
                            <ul>
                                <li>Vertical/Horizontal Edge: Detect specific edge orientations</li>
                                <li>Blur: Smooth the image</li>
                                <li>Sharpen: Enhance edges and details</li>
                                <li>Custom: Design your own 3×3 filter</li>
                            </ul>
                        </li>
                        <li><strong>Custom Filter Editor:</strong> Manually adjust filter values when "Custom" is selected</li>
                    </ul>

                    <h4>Pooling Controls</h4>
                    <ul>
                        <li><strong>Pooling Type:</strong> Choose between max and average pooling</li>
                        <li><strong>Window Size:</strong> Adjust pooling window (2×2, 3×3, 4×4)</li>
                    </ul>

                    <h4>Interactive Features</h4>
                    <ul>
                        <li><strong>Hover Highlighting:</strong> Mouse over output cells to see corresponding input regions</li>
                        <li><strong>Real-time Updates:</strong> All changes update visualizations immediately</li>
                        <li><strong>Color Coding:</strong> Values use consistent color mapping across all displays</li>
                    </ul>
                </div>

                <div class="infotab-panel" data-tab-title="Tips">
                    <h3>Exploration Tips</h3>

                    <h4>Understanding Filters</h4>
                    <ul>
                        <li><strong>Edge Detection:</strong> Try vertical edge filter on horizontal edges input - notice weak response</li>
                        <li><strong>Filter Design:</strong> Positive values detect light-to-dark transitions, negative detect dark-to-light</li>
                        <li><strong>Blur vs Sharpen:</strong> Compare how blur smooths features while sharpen enhances them</li>
                    </ul>

                    <h4>Pooling Insights</h4>
                    <ul>
                        <li><strong>Max vs Average:</strong> Max pooling preserves strong features, average provides smoother results</li>
                        <li><strong>Window Size:</strong> Larger windows create more aggressive downsampling</li>
                        <li><strong>Information Loss:</strong> Notice how pooling reduces detail but maintains overall structure</li>
                    </ul>

                    <h4>Interactive Learning</h4>
                    <ul>
                        <li><strong>Hover Exploration:</strong> Use mouse hover to understand spatial relationships</li>
                        <li><strong>Custom Experiments:</strong> Create custom filters to test specific hypotheses</li>
                        <li><strong>Pattern Matching:</strong> Try different input-filter combinations to see feature detection</li>
                    </ul>

                    <h4>Real-World Applications</h4>
                    <ul>
                        <li><strong>Computer Vision:</strong> These operations are fundamental to image recognition</li>
                        <li><strong>Medical Imaging:</strong> Edge detection helps identify tissue boundaries</li>
                        <li><strong>Engineering:</strong> Feature detection in structural analysis and defect identification</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="demo-area">
            <div style="display: flex; gap: 20px; width: 100%;">
                <div class="plot-container" style="flex: 2;">
                    <div class="canvas-grid">
                        <div>
                            <h3>Input Image</h3>
                            <canvas id="input-canvas" width="300" height="300" style="border: 2px solid #ddd; border-radius: 0;"></canvas>
                        </div>
                        <div>
                            <h3>Filter Visualization</h3>
                            <canvas id="filter-canvas" width="300" height="300" style="border: 2px solid #ddd; border-radius: 0;"></canvas>
                        </div>
                        <div>
                            <h3>Convolution Output</h3>
                            <canvas id="conv-canvas" width="300" height="300" style="border: 2px solid #ddd; border-radius: 0;"></canvas>
                        </div>
                        <div>
                            <h3>Pooling Output</h3>
                            <canvas id="pool-canvas" width="300" height="300" style="border: 2px solid #ddd; border-radius: 0;"></canvas>
                        </div>
                    </div>
                </div>

                <div class="controls" style="flex: 1;">
                    <div class="fancybox-panel">
                        <h4>Input Pattern</h4>
                        <div class="fancybox-container">
                            <div class="fancybox active" data-type="simple" data-color="blue" data-icon="✚" data-label="Cross"></div>
                            <div class="fancybox" data-type="vertical-edges" data-color="orange" data-icon="▌" data-label="Vertical"></div>
                            <div class="fancybox" data-type="horizontal-edges" data-color="purple" data-icon="▬" data-label="Horizontal"></div>
                            <div class="fancybox" data-type="checkerboard" data-color="teal" data-icon="▦" data-label="Checker"></div>
                            <div class="fancybox" data-type="gradient" data-color="green" data-icon="◨" data-label="Gradient"></div>
                        </div>
                    </div>

                    <div class="fancybox-panel">
                        <h4>Filter Type</h4>
                        <div class="fancybox-container">
                            <div class="fancybox active" data-type="edge-vertical" data-color="blue" data-icon="⫽" data-label="V-Edge"></div>
                            <div class="fancybox" data-type="edge-horizontal" data-color="orange" data-icon="⫼" data-label="H-Edge"></div>
                            <div class="fancybox" data-type="blur" data-color="purple" data-icon="◯" data-label="Blur"></div>
                            <div class="fancybox" data-type="sharpen" data-color="teal" data-icon="◆" data-label="Sharpen"></div>
                            <div class="fancybox" data-type="custom" data-color="green" data-icon="⚙" data-label="Custom"></div>
                        </div>
                    </div>

                    <div class="control-group" id="filter-editor">
                        <label>Custom Filter (3×3):</label>
                        <div id="filter-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; width: 150px;">
                            <input type="number" id="f00" step="0.1" value="0" style="width: 45px;">
                            <input type="number" id="f01" step="0.1" value="0" style="width: 45px;">
                            <input type="number" id="f02" step="0.1" value="0" style="width: 45px;">
                            <input type="number" id="f10" step="0.1" value="0" style="width: 45px;">
                            <input type="number" id="f11" step="0.1" value="1" style="width: 45px;">
                            <input type="number" id="f12" step="0.1" value="0" style="width: 45px;">
                            <input type="number" id="f20" step="0.1" value="0" style="width: 45px;">
                            <input type="number" id="f21" step="0.1" value="0" style="width: 45px;">
                            <input type="number" id="f22" step="0.1" value="0" style="width: 45px;">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pooling controls row - full width below charts and sidebar -->
            <div class="pooling-controls-row">
                <div class="fancybox-panel">
                    <h4>Pooling Type</h4>
                    <div class="fancybox-container">
                        <div class="fancybox active" data-type="max" data-color="red" data-icon="⬆" data-label="Max"></div>
                        <div class="fancybox" data-type="average" data-color="blue" data-icon="≈" data-label="Average"></div>
                    </div>
                </div>

                <div id="paramslider-pooling-size" style="flex: 1; max-width: 300px;"></div>

                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <div class="metriclabel" id="conv-size">Conv Size = ?</div>
                    <div class="metriclabel" id="pool-size">Pool Size = ?</div>
                </div>
            </div>
        </div>

        </div>
    </div>

    <script src="../phoebe-js/infotab.js"></script>
    <script src="../phoebe-js/paramslider.js"></script>
    <script src="../phoebe-js/metriclabel.js"></script>
    <script src="script.js"></script>
</body>
</html>