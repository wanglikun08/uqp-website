class TabularAgent{constructor(checkpoint,algorithm){this.algorithm=algorithm||checkpoint.algorithm,this.checkpoint=checkpoint,this.qTable=this.reconstructQTable(checkpoint.q_table.data,checkpoint.q_table.shape),this.discretization=checkpoint.discretization,this.statistics=checkpoint.statistics||{avg_return_last_100:0,max_return:0,epsilon:1},this.sampleTransitions=checkpoint.sample_transitions||[],this.learningCurve=checkpoint.learning_curve||{episodes:[],returns:[]},this.lastAction=null}reconstructQTable(flatData,shape){const[nx,nxd,nt,ntd,na]=shape,table=[];let idx=0;for(let i=0;i<nx;i++){table[i]=[];for(let j=0;j<nxd;j++){table[i][j]=[];for(let k=0;k<nt;k++){table[i][j][k]=[];for(let l=0;l<ntd;l++){table[i][j][k][l]=[];for(let m=0;m<na;m++)table[i][j][k][l][m]=flatData[idx],idx++}}}}return table}discretizeState(state){return{x_idx:this.getBinIndex(state.x,this.discretization.x_bins),xd_idx:this.getBinIndex(state.x_dot,this.discretization.x_dot_bins),t_idx:this.getBinIndex(state.theta,this.discretization.theta_bins),td_idx:this.getBinIndex(state.theta_dot,this.discretization.theta_dot_bins)}}getBinIndex(value,bins){if(value<=bins[0])return 0;if(value>=bins[bins.length-1])return bins.length-2;for(let i=0;i<bins.length-1;i++)if(value>=bins[i]&&value<bins[i+1])return i;return bins.length-2}selectAction(state,epsilon=0){const{x_idx:x_idx,xd_idx:xd_idx,t_idx:t_idx,td_idx:td_idx}=this.discretizeState(state),qValues=this.qTable[x_idx][xd_idx][t_idx][td_idx];return Math.random()<epsilon?this.lastAction=Math.floor(Math.random()*qValues.length):this.lastAction=this.argmax(qValues),this.lastAction}getQValue(state,action){const{x_idx:x_idx,xd_idx:xd_idx,t_idx:t_idx,td_idx:td_idx}=this.discretizeState(state);return this.qTable[x_idx][xd_idx][t_idx][td_idx][action]}getQValues(state){const{x_idx:x_idx,xd_idx:xd_idx,t_idx:t_idx,td_idx:td_idx}=this.discretizeState(state);return this.qTable[x_idx][xd_idx][t_idx][td_idx]}getBestAction(state){const qValues=this.getQValues(state);return this.argmax(qValues)}argmax(array){return array.reduce((maxIdx,val,idx,arr)=>val>arr[maxIdx]?idx:maxIdx,0)}getRandomTransition(){if(0===this.sampleTransitions.length)return null;const idx=Math.floor(Math.random()*this.sampleTransitions.length);return this.sampleTransitions[idx]}getQTableSlice(){const x_idx=this.getNearestBinToZero(this.discretization.x_bins),xd_idx=this.getNearestBinToZero(this.discretization.x_dot_bins),thetaBins=this.discretization.theta_bins.length-1,thetaDotBins=this.discretization.theta_dot_bins.length-1,slice=[];for(let i=0;i<thetaBins;i++){slice[i]=[];for(let j=0;j<thetaDotBins;j++)slice[i][j]=this.qTable[x_idx][xd_idx][i][j]}return slice}getNearestBinToZero(bins){let minDist=1/0,minIdx=0;for(let i=0;i<bins.length-1;i++){const binCenter=(bins[i]+bins[i+1])/2,dist=Math.abs(binCenter);dist<minDist&&(minDist=dist,minIdx=i)}return minIdx}getStatistics(){return this.statistics}getLearningCurve(){return this.learningCurve}}"undefined"!=typeof module&&module.exports&&(module.exports={TabularAgent:TabularAgent});