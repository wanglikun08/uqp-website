<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grid World</title>
    <script src="https://cdn.jsdelivr.net/npm/es6-promise@4.2.8/dist/es6-promise.auto.min.js"></script>
    <script src="../phoebe-js/mathhelper.js"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="../phoebe-js/phoebe.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="iframe-content">
        <div class="container">

        <div class="infotab">
            <div class="infotab-header">
            </div>
            <div class="infotab-content">
                <div class="infotab-panel active" data-tab-title="Introduction">
                    <h3>What is a Grid World?</h3>
                    <p>A grid world is a simple environment where an agent (marked with "A") must navigate from a starting position to a goal while avoiding obstacles. Think of it like a maze or a simple video game level.</p>

                    <p>This demo lets you experience the navigation problem firsthand by manually controlling the agent. You'll see why finding the optimal path isn't always obvious!</p>

                    <p><strong>Why Grid Worlds Matter:</strong></p>
                    <ul>
                        <li><strong>Simple but not trivial</strong> - Easy to visualize, but planning ahead is still challenging</li>
                        <li><strong>Real-world parallels</strong> - Robot navigation, warehouse routing, game AI</li>
                        <li><strong>Foundation for RL</strong> - This problem structure appears throughout reinforcement learning</li>
                    </ul>

                    <p>Try navigating the grid yourself to understand the challenge before learning how algorithms can solve it automatically!</p>
                </div>

                <div class="infotab-panel" data-tab-title="The Problem">
                    <h3>The Navigation Challenge</h3>

                    <p><strong>Your Mission:</strong></p>
                    <p>Navigate the agent from the starting position (lower left) to the goal (upper right) in as few steps as possible.</p>

                    <p><strong>The Environment:</strong></p>
                    <ul>
                        <li><strong>Grid:</strong> 5 √ó 5 cells</li>
                        <li><strong>Start:</strong> Blue cell with "A" in lower left corner</li>
                        <li><strong>Goal:</strong> Yellow cell in upper right corner</li>
                        <li><strong>Obstacles:</strong> Gray cells block your path</li>
                        <li><strong>Valid cells:</strong> White cells are walkable</li>
                    </ul>

                    <p><strong>Movement Rules:</strong></p>
                    <ul>
                        <li>You can move: ‚Üë Up, ‚Üì Down, ‚Üê Left, ‚Üí Right</li>
                        <li>If you try to move into an obstacle or outside the grid, you stay in place</li>
                        <li>Every move counts as one step</li>
                    </ul>

                    <p><strong>Scoring:</strong></p>
                    <ul>
                        <li>Each step costs you -1 point</li>
                        <li>Reaching the goal gives you +10 points</li>
                        <li>Fewer steps = higher score</li>
                    </ul>

                    <p><strong>The Challenge:</strong></p>
                    <p>The obstacles create a barrier that forces you to plan your route. Dead ends waste steps, so you need to think ahead!</p>
                </div>

                <div class="infotab-panel" data-tab-title="Instructions">
                    <h3>How to Use This Demo</h3>

                    <p><strong>Manual Control:</strong></p>
                    <ul>
                        <li>Use the arrow buttons or keyboard arrow keys to move the agent</li>
                        <li>Watch the total reward accumulate with each step</li>
                        <li>Try to find the shortest path to the goal</li>
                        <li>Click "Reset" to start over from the beginning</li>
                    </ul>

                    <p><strong>Visual Guide:</strong></p>
                    <ul>
                        <li><strong>Blue cell with "A":</strong> Agent's current position</li>
                        <li><strong>Yellow cell with "GOAL":</strong> Target destination</li>
                        <li><strong>Gray cells:</strong> Obstacles (impassable)</li>
                        <li><strong>White cells:</strong> Empty, walkable cells</li>
                        <li><strong>Light blue cells:</strong> Your path history</li>
                    </ul>

                    <p><strong>Understanding the Metrics:</strong></p>
                    <ul>
                        <li><strong>Steps:</strong> Total number of moves taken</li>
                        <li><strong>Total Reward:</strong> Cumulative reward (starts at 0, decreases by 1 per step, +10 at goal)</li>
                        <li><strong>Status:</strong> Current state (Ready / In Progress / Goal Reached!)</li>
                    </ul>
                </div>

                <div class="infotab-panel" data-tab-title="Tips">
                    <h3>Navigation Strategy</h3>

                    <p><strong>Key Points:</strong></p>
                    <ul>
                        <li>The optimal path is 8 steps (best score: +2 points)</li>
                        <li>Obstacles form a wall requiring strategic navigation</li>
                        <li>Don't move right immediately - there's an obstacle blocking</li>
                        <li>Plan ahead to avoid dead ends and backtracking</li>
                    </ul>

                    <p><strong>Practice Approach:</strong></p>
                    <ul>
                        <li>Try 1: Reach the goal any way you can</li>
                        <li>Try 2: Count steps and optimize your path</li>
                        <li>Challenge: Find the 8-step optimal solution</li>
                        <li><strong>Pro tip:</strong> Try mentally tracking the "value" (expected future reward) of each square you visit - this is exactly what RL algorithms learn!</li>
                    </ul>

                    <p><strong>Next:</strong> Learn how RL algorithms automatically discover optimal paths through trial and error!</p>
                </div>

                <div class="infotab-panel" data-tab-title="Compete">
                    <h3>Live Competition Mode</h3>

                    <p><strong>Challenge:</strong> Navigate the 6√ó6 grid world over 3 attempts and compete for the highest total score in your class!</p>

                    <p><span style="color: darkred; font-weight: bold;">‚ö†Ô∏è Keep this tab active - switching to another tab may temporarily remove you from the leaderboard</span></p>

                    <p><strong>Competition Rules:</strong></p>
                    <ul>
                        <li>Everyone plays the same 6√ó6 grid with fog of war</li>
                        <li>You must complete all 3 attempts</li>
                        <li>Your score is submitted automatically after attempt 3 completes</li>
                        <li><strong>One-time only:</strong> Your first completion counts - no retries</li>
                        <li>Real-time leaderboard shows top performers</li>
                    </ul>

                    <div id="username-display-info" style="display: none; margin: 10px 0; padding: 10px; background: #e8f4fd; border: 1px solid #bee5eb; border-radius: 4px;">
                        Your anonymous name: <span id="competition-username-info" style="font-weight: bold; color: #3498db;"></span>
                    </div>

                    <p><strong>Three-Attempt Structure:</strong></p>
                    <ul>
                        <li><strong>Attempt 1:</strong> Pure exploration - fog of war, no information</li>
                        <li><strong>Attempt 2:</strong> Value estimates shown on visited cells from attempt 1</li>
                        <li><strong>Attempt 3:</strong> Back to fog of war - test your memory!</li>
                    </ul>

                    <p><strong>Scoring:</strong></p>
                    <ul>
                        <li>Goal reward: +20 points</li>
                        <li>Step penalty: -1 per move</li>
                        <li>Small treats: +1 and +2 along the way (repeatable)</li>
                        <li><strong>Final Score:</strong> Sum of all rewards across 3 attempts</li>
                    </ul>

                    <p><strong>Strategy Tips:</strong></p>
                    <ul>
                        <li>Explore efficiently in attempt 1 to build good value estimates</li>
                        <li>Use value information in attempt 2 to find optimal path</li>
                        <li>Memorize the best route for attempt 3</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Main Grid World Area -->
        <div class="demo-area">
            <div class="demo-tabs">
                <!-- Tab Header -->
                <div class="demo-tab-header" id="demo-tab-header">
                    <button class="demo-tab-button active" data-tab="normal">Normal</button>
                    <button class="demo-tab-button" data-tab="fogofwar">Fog of War</button>
                </div>

                <!-- Tab 1: Normal Mode -->
                <div class="demo-tab-content active" data-tab="normal">
                    <div class="grid-container">
                        <h3 id="mode-title" style="text-align: center; margin-bottom: 20px;">Navigate to the Goal</h3>
                        <p id="mode-subtitle" style="text-align: center; color: #6c757d; margin-bottom: 20px; display: none;"></p>

                        <div id="competition-instructions" class="competition-instructions" style="display: none;">
                            <div id="instructions-content" class="instructions-content">
                                <p><strong>Instructions:</strong></p>
                                <p>In this grid world you will receive <strong>+20</strong> for reaching the goal and <strong>-1</strong> for each step. There are some small treats along the way that don't end the game (unlike the goal), you may visit them as many times as you like.</p>
                                <p><strong>You have 3 attempts in total:</strong></p>
                                <ul>
                                    <li><strong>Attempt 1:</strong> No information available, explore the grid.</li>
                                    <li><strong>Attempt 2:</strong> Value estimates are shown on squares visited in attempt 1, try to find the optimal path!</li>
                                    <li><strong>Attempt 3:</strong> No information again, how much do you remember?</li>
                                </ul>
                                <p>Your final score is the total reward received throughout the 3 attempts. <em>Only the first full run will be recorded.</em></p>
                            </div>
                            <div class="instructions-toggle">
                                <a href="#" id="toggle-instructions" onclick="toggleInstructions(event)">Hide Instructions</a>
                            </div>
                        </div>

                        <div class="grid-wrapper">
                            <canvas id="gridCanvas"></canvas>
                            <div id="coordinate-display" class="coordinate-display"></div>
                        </div>

                        <div class="controls-panel">
                            <!-- Stats display - changes based on mode -->
                            <div class="stats-display" id="stats-normal">
                                <div class="stat-item">
                                    <span class="stat-label">Steps:</span>
                                    <span class="stat-value" id="steps-count">0</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Total Reward:</span>
                                    <span class="stat-value" id="total-reward">0</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Status:</span>
                                    <span class="stat-value" id="status">Ready</span>
                                </div>
                            </div>

                            <!-- Competition mode stats -->
                            <div class="stats-display" id="stats-competition" style="display: none;">
                                <div class="stat-item">
                                    <span class="stat-label">Attempt:</span>
                                    <span class="stat-value" id="attempt-count">1 / 3</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Steps:</span>
                                    <span class="stat-value" id="steps-count-comp">0</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Current Reward:</span>
                                    <span class="stat-value" id="current-reward">0</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Total Score:</span>
                                    <span class="stat-value" id="total-score">0</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Status:</span>
                                    <span class="stat-value" id="status-comp">Ready</span>
                                </div>
                            </div>

                            <div class="direction-controls">
                                <div class="arrow-row">
                                    <button class="arrow-btn" id="btn-up" onclick="moveAgent('up')">‚Üë</button>
                                </div>
                                <div class="arrow-row">
                                    <button class="arrow-btn" id="btn-left" onclick="moveAgent('left')">‚Üê</button>
                                    <button class="arrow-btn" id="btn-down" onclick="moveAgent('down')">‚Üì</button>
                                    <button class="arrow-btn" id="btn-right" onclick="moveAgent('right')">‚Üí</button>
                                </div>
                            </div>

                            <div id="button-controls" style="display: flex; gap: 10px; justify-content: center;">
                                <button class="reset-button" onclick="resetEnvironment()">Reset</button>
                                <button class="attempt-button" id="next-attempt-btn" onclick="startNextAttempt()" style="display: none;">Start Attempt 2</button>
                            </div>

                            <!-- Leaderboard Panel -->
                            <div class="leaderboard-panel" id="leaderboard-panel" style="display: none; margin: 30px auto 0 auto;">
                                <div class="panel-title">üèÜ Live Competition Leaderboard - Top 10</div>
                                <div class="leaderboard-status" id="leaderboard-status">
                                    <span class="status-indicator" id="status-dot"></span>
                                    <span id="status-text">Connecting...</span>
                                </div>
                                <div class="leaderboard-content" id="leaderboard-content">
                                    <div class="your-position" id="your-position"></div>
                                    <div class="leaderboard-list" id="leaderboard-list"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        </div>
    </div>

    <script src="../phoebe-js/infotab.js"></script>
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    <script src="../leaderboard-client.js"></script>
    <script src="script.js"></script>
</body>
</html>
